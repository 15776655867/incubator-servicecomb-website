<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.4.1 by Michael Rose
  Copyright 2017 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Metrics in 1.0.0-m1 - Apache ServiceComb (incubating)</title>




<meta name="description" content="Metrics in 1.0.0-m1">




<meta name="author" content="">

<meta property="og:locale" content="en">
<meta property="og:site_name" content="Apache ServiceComb (incubating)">
<meta property="og:title" content="Metrics in 1.0.0-m1">


  <link rel="canonical" href="http://localhost:4000/users/metrics-in-1.0.0-m1/">
  <meta property="og:url" content="http://localhost:4000/users/metrics-in-1.0.0-m1/">



  <meta property="og:description" content="Metrics in 1.0.0-m1">



  <meta name="twitter:site" content="@ServiceComb">
  <meta name="twitter:title" content="Metrics in 1.0.0-m1">
  <meta name="twitter:description" content="Metrics in 1.0.0-m1">
  <meta name="twitter:url" content="http://localhost:4000/users/metrics-in-1.0.0-m1/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  












  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Apache ServiceComb (incubating)",
      "url" : "http://localhost:4000",
      "sameAs" : null
    }
  </script>



  <meta name="google-site-verification" content="HvJjNd7vvJ-yjSTHlBiIWEYxp_Hrz-PYEY5Idz9LRcA" />




<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Apache ServiceComb (incubating) Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js"></script>
<script src="http://localhost:4000/assets/vendor/prism/prism.js"></script>

<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
<link rel="stylesheet" href="http://localhost:4000/assets/vendor/prism/prism.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->

<meta http-equiv="cleartype" content="on">

    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->
<link href="https://fonts.cat.net/css?family=Roboto:400,500,700|Source+Code+Pro" rel="stylesheet">
<script src="http://localhost:4000/assets/js/custom.js"></script>
<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
	      
          <a class="site-title active" href="http://localhost:4000/"><img src="http://localhost:4000//assets/images/ServiceComb-logo-1.png"></a>
	      
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              
              
              
                <a href="http://localhost:4000/docs/quick-start/">Quick Start</a>
              
            </li>
          
            
            <li class="masthead__menu-item">
              
              
              
                <a class="active" href="http://localhost:4000/users/">Users</a>
              
            </li>
          
            
            <li class="masthead__menu-item">
              
              
              
                <a href="http://localhost:4000/developers/">Developers</a>
              
            </li>
          
            
            <li class="masthead__menu-item">
              
              
              
                <a href="http://localhost:4000/year-archive/">Blogs</a>
              
            </li>
          
            
            <li class="masthead__menu-item">
              
              
              
                <a href="http://localhost:4000/faqs/">FAQ</a>
              
            </li>
          
            
            <li class="masthead__menu-item">
              
              
              
                <a href="http://localhost:4000/release/">Downloads</a>
              
            </li>
          
        </ul>
        <button><div class="navicon"></div></button>
        <ul class="hidden-links hidden"></ul>
        <div class="nav-lang">
          
            
            <a href=/cn/users/metrics-in-1.0.0-m1/>中文</a>
          
        </div>
      </nav>
    </div>
  </div>
</div>


    



<div id="main" role="main">
  
  <div class="sidebar sticky">
      
      <div class="back-to-home">Home > <a href="/">ServiceComb</a></div>
      
  
  
    
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">User Guide</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/" class="">Java Chassis Architecture</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/setup-environment/" class="">Setup Environment</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Develop Service Provider</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/service-definition/" class="">Service Definition</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/service-contract/" class="">Service Contract</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/develop-with-springmvc/" class="">Develop Microservice with SpringMVC</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/develop-with-jax-rs/" class="">Develop Microservice with JAX-RS</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/develop-with-transparent-rpc/" class="">Develop Microservice with Transparent RPC</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/service-interface-constraints/" class="">Service Interface Constraints</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/service-configurations/" class="">Service Configurations</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/communicate-protocol/" class="">Communicate Protocol</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/application-boot-process/" class="">Application Boot Up Process</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/service-heartbeat/" class="">Service Heartbeat</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Develop Service Consumer</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/develop-with-rest-template/" class="">Develop with Rest Template</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/develop-with-rpc/" class="">Develop with Transparent RPC</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/use-service-contract/" class="">Use Service Contract</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/invoke-control/" class="">Invoke Control</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">General Development</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/local-develop-test/" class="">Develop and Test in Local Environment</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/use-servicecomb-in-spring-boot/" class="">Use ServiceComb in Spring Boot</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/distributed-tracing/" class="">Distributed Tracing</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/customized-tracing/" class="">Customized Tracing</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="http://localhost:4000/users/dynamic-config/"><span class="nav__sub-title nav__sub-title-with-url">Dynamic Configurations</span></a>
        

        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Edging Service</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/edging-service/nginx/" class="">confd and Nginx</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/edging-service/zuul/" class="">Zuul</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Monitor</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/metrics-in-1.0.0-m1/" class="active">Metrics-in-1.0.0-m1</a></li>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/metrics-integration-with-prometheus-in-1.0.0-m1/" class="">Metrics-integration-with-prometheus-in-1.0.0-m1</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Deployment</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/run-mode/" class="">Run Mode</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Security</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="http://localhost:4000/users/use-tls/" class="">Use TLS</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Metrics in 1.0.0-m1">
    <meta itemprop="description" content="Metrics in 1.0.0-m1">
    
    <meta itemprop="dateModified" content="December 30, 2017">

    <div class="page__inner-wrap">
      
        
          <header>
            <h1 class="page__title" itemprop="headline">Metrics in 1.0.0-m1
</h1>
            
          </header>
        
      

      <section class="page__content" itemprop="text">
        <aside class="sidebar__right">
<nav class="toc">
    <!-- <header><h4 class="nav__title"><i class="fa fa-file-text"></i> On This Page</h4></header> -->
<ul class="toc__menu" id="markdown-toc">
  <li><a href="#background" id="markdown-toc-background">Background</a></li>
  <li><a href="#1000-m1-principles" id="markdown-toc-1000-m1-principles">1.0.00-m1 Principles</a>    <ul>
      <li><a href="#use-event-collect-invocation-datanot-from-hystrixhandler-bizkeeperany-more" id="markdown-toc-use-event-collect-invocation-datanot-from-hystrixhandler-bizkeeperany-more">Use event collect invocation data,not from Hystrix(handler-bizkeeper)any more</a></li>
      <li><a href="#use-netflix-servo-as-monitor-of-metric" id="markdown-toc-use-netflix-servo-as-monitor-of-metric">Use Netflix Servo as Monitor of Metric</a></li>
      <li><a href="#window-timealso-may-called-polling-interval-or-step-cycle" id="markdown-toc-window-timealso-may-called-polling-interval-or-step-cycle">Window Time(also may called ‘Polling Interval’ or ‘Step Cycle’)</a></li>
    </ul>
  </li>
  <li><a href="#metric-list" id="markdown-toc-metric-list">Metric List</a></li>
  <li><a href="#how-configuration" id="markdown-toc-how-configuration">How Configuration</a>    <ul>
      <li><a href="#global-configuration" id="markdown-toc-global-configuration">Global Configuration</a></li>
      <li><a href="#maven-configuration" id="markdown-toc-maven-configuration">Maven Configuration</a></li>
    </ul>
  </li>
  <li><a href="#metrics-publish" id="markdown-toc-metrics-publish">Metrics Publish</a>    <ul>
      <li><a href="#embedded-publish-interface" id="markdown-toc-embedded-publish-interface">Embedded publish interface</a></li>
      <li><a href="#direct-programming-get" id="markdown-toc-direct-programming-get">Direct programming get</a></li>
    </ul>
  </li>
  <li><a href="#other-reference" id="markdown-toc-other-reference">Other Reference</a></li>
</ul>

  </nav>
</aside>

<p>Metrics had supported from Java chassis version 0.5.0,in version 1.0.0-m1,we had reconstruction it and add some more features,please checkout the user guide and <a href="https://github.com/apache/incubator-servicecomb-java-chassis/releases">release note</a> for more information.Also subscribe ServiceComb mail-list(dev-subscribe@servicecomb.incubator.apache.org) and join discussion is welcome.</p>

<h2 id="background">Background</h2>
<p>Microservice is trend of technology,it resolve many problems also follows new problem.</p>

<p><img src="/assets/images/MonolithicArch.png" alt="MonolithicArch" /></p>

<p>This is traditional software architecture always called ‘Monolithic’,it’s difficult for developer maintain the code or add new feature because of tight coupling,but it’s easy for operation engineer deploy and maintenance(only one system process).</p>

<p><img src="/assets/images/MicroserviceArch.png" alt="MicroserviceArch" /></p>

<p>This is microservice system architecture,after split ‘Monolithic’ into many small services,developer obtain many benefits such as architecture independent and more agility etc,but operation engineer need to maintenance a whole lot of microservice instances.If don’t import metrics,when system  is abnormal or user experience getting worse,it’s very difficult to dentifying where the problem is and make some strategy in order to prevent it.</p>

<h2 id="1000-m1-principles">1.0.00-m1 Principles</h2>
<p>In previous version(0.5.0)，implementation of metrics had some imperfections:</p>
<ol>
  <li>Metrics code written in foundation-metrics module,it’s a low level module,and include some customized function;</li>
  <li>Use ThreadLocal variable collect and statistics data,performance hight but has memory leak risk;</li>
  <li>Output data of metrics is joined text not dependent number,difficult to reuse;</li>
  <li>Not support publish,unable integration with other monitor system;</li>
  <li>Because foundation-metrics is a low level module and certainly be loaded,user can’t exclude it if unnecessary.</li>
</ol>

<p>So,upgrading from 0.5.0 to 1.0.0-m1,we had done a fully reconstruction,now it’s include this modules:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Module Name</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">metrics-core</td>
      <td style="text-align: left">Metrics core module,work immediately after imported</td>
    </tr>
    <tr>
      <td style="text-align: left">metrics-common</td>
      <td style="text-align: left">Metrics common module,include DTO classes</td>
    </tr>
    <tr>
      <td style="text-align: left">metrics-extension</td>
      <td style="text-align: left">Include some metrics extension module</td>
    </tr>
    <tr>
      <td style="text-align: left">metrics-integration</td>
      <td style="text-align: left">Include metrics Integration with other monitor system</td>
    </tr>
  </tbody>
</table>

<p>The dependency of this modules is:
<img src="/assets/images/MetricsDependency.png" alt="MetricsDependency.png" /></p>

<h3 id="use-event-collect-invocation-datanot-from-hystrixhandler-bizkeeperany-more">Use event collect invocation data,not from Hystrix(handler-bizkeeper)any more</h3>
<p>From 1.0.0-m1 invocation data such as TPS and latency are collected from invocation event,not from Hystrix（handler-bizkeeper） any more,so you don’t need add Java Chassis Bizkeeper Handler only for metrics.we use EventBus in foundation-common,when DefaultEventListenerManager in metrics-core had initialized,three event listener class will be auto registered:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Event Listener Name</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">InvocationStartedEventListener</td>
      <td style="text-align: left">Trigger when consumer or producer called</td>
    </tr>
    <tr>
      <td style="text-align: left">InvocationStartProcessingEventListener</td>
      <td style="text-align: left">Trigger when producer fetch invocation from queue and start process</td>
    </tr>
    <tr>
      <td style="text-align: left">InvocationFinishedEventListener</td>
      <td style="text-align: left">Trigger when consumer call returned or producer process finished</td>
    </tr>
  </tbody>
</table>

<p><em>ServiceComb java chassis had used <a href="http://vertx.io/">Vertx</a> as Reactor framework,in synchronous call mode when producer received invocation from consumer,it won’t start process immediately but put it into a queue,this queue called invocation queue(like disk queue in operation system),time waiting in the queue called <strong>LifeTimeInQueue</strong>,the length of the queue called <strong>waitInQueue</strong>,this two metrics are very important for measure stress of the microservice;consumer not has this queue,so InvocationStartProcessingEvent will never be triggered at consumer side.</em></p>

<p>The code for trigger event write in RestInvocation,HighwayServerInvoke and InvokerUtils,if microservice don’t import metrics,event listener of metrics won’t be registered,the impact on performance is little.</p>

<h3 id="use-netflix-servo-as-monitor-of-metric">Use Netflix Servo as Monitor of Metric</h3>
<p><a href="https://github.com/Netflix/servo">Netflix Servo</a> had implement a collection of high performance monitor,we had used four of them:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Monitor Name</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">BasicCounter</td>
      <td style="text-align: left">As name of it,always increment</td>
    </tr>
    <tr>
      <td style="text-align: left">StepCounter</td>
      <td style="text-align: left">Called ‘ResettableCounter’ before</td>
    </tr>
    <tr>
      <td style="text-align: left">MinGauge</td>
      <td style="text-align: left">Mark min value in step</td>
    </tr>
    <tr>
      <td style="text-align: left">MaxGauge</td>
      <td style="text-align: left">Mark max value in step</td>
    </tr>
  </tbody>
</table>

<p><em>The version of Servo we used is 0.10.1</em></p>

<h3 id="window-timealso-may-called-polling-interval-or-step-cycle">Window Time(also may called ‘Polling Interval’ or ‘Step Cycle’)</h3>
<p>Metrics had many classifications,we can divided them into two major types by how get value:</p>
<ol>
  <li>Direct get<br />
  You can direct get newest value anytime,such as system resource usage include cpu load rate,running thread count,heap size and call count,queue length,etc.</li>
  <li>From statistics<br />
  After a ‘certain time’ passed can counting the value,this time we called ‘Window Time’,include:<br />
  a) Take one from many,like Max、Min、Median; <br />
  b) Time-related,like TPS(transaction per second);  <br />
  c) Count-related,like average,variance.  <br />
  If get value of this type,the result returned is the last ‘Step Cycle’ counted.in Servo,this time called <a href="https://github.com/Netflix/servo/wiki/Getting-Started">‘Polling Intervals’</a>.
  From 1.0.0-m1,can set <strong>servicecomb.metrics.window_time</strong> in microservice.yaml,it has same effect as set <strong>servo.pollers</strong>.</li>
</ol>

<h2 id="metric-list">Metric List</h2>
<p>From 1.0.0-m1,start support output metrics of operation level:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Group</th>
      <th style="text-align: left">Level</th>
      <th style="text-align: left">Catalog</th>
      <th style="text-align: left">Metrics</th>
      <th style="text-align: left">Item</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance</td>
      <td style="text-align: left">system</td>
      <td style="text-align: left">cpu</td>
      <td style="text-align: left">load</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance</td>
      <td style="text-align: left">system</td>
      <td style="text-align: left">cpu</td>
      <td style="text-align: left">runningThreads</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance</td>
      <td style="text-align: left">system</td>
      <td style="text-align: left">heap</td>
      <td style="text-align: left">init</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance</td>
      <td style="text-align: left">system</td>
      <td style="text-align: left">heap</td>
      <td style="text-align: left">max</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance</td>
      <td style="text-align: left">system</td>
      <td style="text-align: left">heap</td>
      <td style="text-align: left">commit</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance</td>
      <td style="text-align: left">system</td>
      <td style="text-align: left">heap</td>
      <td style="text-align: left">used</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance</td>
      <td style="text-align: left">system</td>
      <td style="text-align: left">nonHeap</td>
      <td style="text-align: left">init</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance</td>
      <td style="text-align: left">system</td>
      <td style="text-align: left">nonHeap</td>
      <td style="text-align: left">max</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance</td>
      <td style="text-align: left">system</td>
      <td style="text-align: left">nonHeap</td>
      <td style="text-align: left">commit</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance</td>
      <td style="text-align: left">system</td>
      <td style="text-align: left">nonHeap</td>
      <td style="text-align: left">used</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">producer</td>
      <td style="text-align: left">waitInQueue</td>
      <td style="text-align: left">count</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">producer</td>
      <td style="text-align: left">lifeTimeInQueue</td>
      <td style="text-align: left">average</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">producer</td>
      <td style="text-align: left">lifeTimeInQueue</td>
      <td style="text-align: left">max</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">producer</td>
      <td style="text-align: left">lifeTimeInQueue</td>
      <td style="text-align: left">min</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">producer</td>
      <td style="text-align: left">executionTime</td>
      <td style="text-align: left">average</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">producer</td>
      <td style="text-align: left">executionTime</td>
      <td style="text-align: left">max</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">producer</td>
      <td style="text-align: left">executionTime</td>
      <td style="text-align: left">min</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">producer</td>
      <td style="text-align: left">producerLatency</td>
      <td style="text-align: left">average</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">producer</td>
      <td style="text-align: left">producerLatency</td>
      <td style="text-align: left">max</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">producer</td>
      <td style="text-align: left">producerLatency</td>
      <td style="text-align: left">min</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">producer</td>
      <td style="text-align: left">producerCall</td>
      <td style="text-align: left">total</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">producer</td>
      <td style="text-align: left">producerCall</td>
      <td style="text-align: left">tps</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">consumer</td>
      <td style="text-align: left">consumerLatency</td>
      <td style="text-align: left">average</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">consumer</td>
      <td style="text-align: left">consumerLatency</td>
      <td style="text-align: left">max</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">consumer</td>
      <td style="text-align: left">consumerLatency</td>
      <td style="text-align: left">min</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">consumer</td>
      <td style="text-align: left">consumerCall</td>
      <td style="text-align: left">total</td>
    </tr>
    <tr>
      <td style="text-align: left">servicecomb</td>
      <td style="text-align: left">instance | operationName</td>
      <td style="text-align: left">consumer</td>
      <td style="text-align: left">consumerCall</td>
      <td style="text-align: left">tps</td>
    </tr>
  </tbody>
</table>

<p><strong>When the value of Level is ‘instance’,it’s means microservice instance metric,otherwise specific operation metric,operationName same as Java Chassis MicroserviceQualifiedName,it’s joined with microservice appId.SchemaID.methodName.</strong></p>

<h2 id="how-configuration">How Configuration</h2>
<h3 id="global-configuration">Global Configuration</h3>
<p>Please add window time config in microservice.yaml:</p>
<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">APPLICATION_ID</span><span class="pi">:</span> <span class="s">demo</span>
<span class="s">service_description</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">demoService</span>
  <span class="s">version</span><span class="pi">:</span> <span class="s">0.0.1</span>

<span class="s">servicecomb</span><span class="pi">:</span>
  <span class="s">metrics</span><span class="pi">:</span>
    <span class="c1">#window time,same as servo.pollers,unit is millisecond</span>
    <span class="c1">#support multi window time and use ',' split them,like 5000,10000</span>
    <span class="s">window_time</span><span class="pi">:</span> <span class="s">5000,10000</span>
</code></pre>
</div>

<p><em>The setting of window time is very important to getting value of metrics,here is a comment show how it effect</em></p>

<p><img src="/assets/images/TimeWindowComment.png" alt="TimeWindowComment.png" /></p>

<h3 id="maven-configuration">Maven Configuration</h3>
<p>We just only need add metrics-core dependency:</p>
<div class="language-xml highlighter-rouge"><pre class="highlight"><code>    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>io.servicecomb<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>metrics-core<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.0.0-m1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
</code></pre>
</div>

<h2 id="metrics-publish">Metrics Publish</h2>
<p>After configuration completed,you can get collected metrics data via this method:</p>
<h3 id="embedded-publish-interface">Embedded publish interface</h3>
<p>When microservice start-up,metrics-core will auto publish data service using Springmvc provider:</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@RestSchema</span><span class="o">(</span><span class="n">schemaId</span> <span class="o">=</span> <span class="s">"metricsEndpoint"</span><span class="o">)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/metrics"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DefaultMetricsPublisher</span> <span class="kd">implements</span> <span class="n">MetricsPublisher</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">DefaultMetricsPublisher</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/appliedWindowTime"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
  <span class="nd">@CrossOrigin</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="nf">getAppliedWindowTime</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getAppliedWindowTime</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
  <span class="nd">@CrossOrigin</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">RegistryMetric</span> <span class="nf">metrics</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getRegistryMetric</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@ApiResponses</span><span class="o">({</span>
      <span class="nd">@ApiResponse</span><span class="o">(</span><span class="n">code</span> <span class="o">=</span> <span class="mi">400</span><span class="o">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"illegal request content"</span><span class="o">),</span>
  <span class="o">})</span>
  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/{windowTime}"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
  <span class="nd">@CrossOrigin</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">RegistryMetric</span> <span class="nf">metricsWithWindowTime</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"windowTime"</span><span class="o">)</span> <span class="kt">long</span> <span class="n">windowTime</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getRegistryMetric</span><span class="o">(</span><span class="n">windowTime</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<p>So,if you had config rest provider in microservice.yaml,like:</p>
<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">cse</span><span class="pi">:</span>
  <span class="s">service</span><span class="pi">:</span>
    <span class="s">registry</span><span class="pi">:</span>
      <span class="s">address</span><span class="pi">:</span> <span class="s">http://127.0.0.1:30100</span>
  <span class="s">rest</span><span class="pi">:</span>
    <span class="s">address</span><span class="pi">:</span> <span class="s">0.0.0.0:8080</span>
</code></pre>
</div>
<p>You can open a browser and input http://localhost:8080/metrics direct get metrics data.</p>
<h3 id="direct-programming-get">Direct programming get</h3>
<p>From above code you can known,the interface of data provider bean is io.servicecomb.metrics.core.publish.DataSource,so if you want develop your own metrics publisher,autowired it is enough.</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Autowired</span>
<span class="kd">private</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>
</code></pre>
</div>

<h2 id="other-reference">Other Reference</h2>
<p>We had developed two use case for reference:</p>
<ol>
  <li>metrics-wirte-file:ouput metrics data into files,code is at metrics-extension;</li>
  <li>metrics-prometheus:integration with prometheus,publish metrics as prometheus producer.</li>
</ol>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      

    </div>

    
  </article>

  
  
</div>


    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <div align="center" style="margin: 0 0;">
    <ins class="adsbygoogle"
         style="display:block; border-bottom: initial;"
         data-ad-client="ca-pub-7328585512091257"
         data-ad-slot="3049671934"
         data-ad-format="auto"></ins>
    </div>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="container">
  <div class="row justify-content-md-center">
    
    <div class="col">
      <ul>
        <p class="header">Resources</p>
        <li><a href="/docs/quick-start/">Quick Start</a></li>
        <li><a href="/users/user-guide/">User Guide</a></li>
        <li><a href="/slides/">Slides</a></li>
        <li><a href="/users/faq/">Common Questions</a></li>
      </ul>
    </div>
    <div class="col">
      <ul>
        <p class="header">Contribute</p>
        <li><a href="https://github.com/apache/incubator-servicecomb-website/issues/new?title=Issue with _users/metrics-in-1.0.0-m1.md">Report a Doc Issue</a></li>
        <li><a href="https://github.com/apache/incubator-servicecomb-website/edit/master/_users/metrics-in-1.0.0-m1.md">Edit This Page on Github</a></li>
        <li><a href="/developers/submit-codes/">Code Submit Guide</a></li>
      </ul>
    </div>
    <div class="col">
      <ul class="social-icons">
        <p class="header">Community</p>
        <li>
            <a href="mailto:dev-subscribe@servicecomb.incubator.apache.org" rel="nofollow"><span class="mail">Mailing List</span></a>
        </li>
        <li>
            <a href="https://github.com/apache?q=ServiceComb" target="_blank"><span class="github">Github</span></a>
        </li>
        <li>
            <a href="https://twitter.com/ServiceComb" target="_blank"><span class="twitter">Twitter</span></a>
        </li>
        <li>
            <a href="http://localhost:4000/feed.xml" target="_blank"><span class="rss">Feed</span></a>
        </li>
      </ul>
    </div>
  </div>
</div>
<div class="page__footer-bottom">
  <div>&copy; 2018 Apache ServiceComb (incubating). Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
</div>

      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101622733-1', 'auto');
  ga('send', 'pageview');
</script>







  </body>
</html>
